<div class="page-content-wrapper">
    <div class="page-content">
        <div class="row">
            <div class="col-md-12 col-xs-12">
                <div class="hr">
                    <h4 class="text-info">Manage Medical Services
                        <div class="pull-right">
                            <a routerLink="add">
                                <button class="btn mt-sweetalert btn green-meadow">
                                    <i class="fa fa-plus"></i> Add
                                </button>
                            </a>

                            <span>
                                <button
                                        class="btn btn-default btn-outline"> <i
                                        class=" icon-clock"></i> Print
                                </button>
                            </span>
                        </div>
                    </h4>

                </div>

            </div>
        </div>

        <ngx-loading [show]="loading"></ngx-loading>
        <!--table-->
        <p-table #dt [columns]="cols" [value]="dataMD" [paginator]="true" [rows]="5">
            <ng-template pTemplate="caption">
                <div style="text-align: right">
                    <i class="fa fa-search" style="margin:4px 4px 0 0"></i>
                    <input type="text" pInputText size="50" placeholder="Search Against Name, Code, Fee, Tax, or Cost"
                           (input)="dt.filterGlobal($event.target.value, 'contains')" style="width:auto">
                </div>
            </ng-template>
            <ng-template sortable="true" pTemplate="header" let-columns>
                <tr>
                    <th *ngFor="let col of columns" [pSortableColumn]="col.field" [ngSwitch]="col.field">
                        <span *ngSwitchCase="'name'"> {{col.header}}
                            <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                        </span>
                        <span *ngSwitchCase="'code'"> {{col.header}}
                            <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                        </span>
                        <span *ngSwitchCase="'branch'"> {{col.header}} </span>
                        <span *ngSwitchCase="'department'"> {{col.header}} </span>
                        <span *ngSwitchCase="'fee'"> {{col.header + " ("+this.currency+")" }}
                            <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                        </span>
                        <span *ngSwitchCase="'tax'"> {{col.header}}
                            <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                        </span>
                        <span *ngSwitchCase="'cost'"> {{col.header + " ("+this.currency+")" }}
                            <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                        </span>
                        <span *ngSwitchCase="'status'"> {{col.header}} </span>
                        <span *ngSwitchCase="'action'"> {{col.header}} </span>
                    </th>
                </tr>
                <!--<tr>
                    <th *ngFor="let col of columns" [ngSwitch]="col.field">
                        <input *ngSwitchCase="'name'" pInputText type="text"  style="width: 100%" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        <input *ngSwitchCase="'code'" pInputText type="text"  style="width: 100%" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        <input *ngSwitchCase="'fee'" pInputText type="text"  style="width: 100%" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        <input *ngSwitchCase="'tax'" pInputText type="text"  style="width: 100%" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        <input *ngSwitchCase="'cost'" pInputText type="text"  style="width: 100%" (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                    </th>
                </tr>-->
            </ng-template>

            <!--<ng-template pTemplate="header" let-columns>
                <tr>
                    <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                        {{col.header}}
                        <p-sortIcon
                                [field]="col.field" ariaLabel="Activate to sort"
                                ariaLabelDesc="Activate to sort in descending order"
                                ariaLabelAsc="Activate to sort in ascending order">
                        </p-sortIcon>
                    </th>
                </tr>
                <tr>
                    <th *ngFor="let col of columns" [ngSwitch]="col.field">
                        <input *ngSwitchCase="'name'" pInputText type="text" style="width: 100%"
                               (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        <input *ngSwitchCase="'code'" pInputText type="text" style="width: 100%"
                               (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        &lt;!&ndash;<input *ngSwitchCase="'branch'" pInputText type="text" style="width: 100%"&ndash;&gt;
                        &lt;!&ndash;(input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">&ndash;&gt;
                        &lt;!&ndash;<input *ngSwitchCase="'department'" pInputText type="text" style="width: 100%"&ndash;&gt;
                        &lt;!&ndash;(input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">&ndash;&gt;
                        <input *ngSwitchCase="'fee'" pInputText type="text" style="width: 100%"
                               (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        <input *ngSwitchCase="'tax'" pInputText type="text" style="width: 100%"
                               (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        <input *ngSwitchCase="'cost'" pInputText type="text" style="width: 100%"
                               (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">
                        <input *ngSwitchCase="'status'" pInputText type="text" style="width: 100%"
                               (input)="dt.filter($event.target.value, col.field, col.filterMatchMode)">

                    </th>
                </tr>
            </ng-template>-->
            <ng-template pTemplate="body" let-item>
                <tr>
                    <td>{{item.name}}</td>
                    <td>{{item.code}}</td>
                    <td>
                        <a href="#popupBranches" data-toggle="modal">
                            <button
                                    class="btn mt-sweetalert btn green-meadow"
                                    title="Click to view details"
                                    (click)="getCheckedBranchesByMedicalServiceId(item)"
                                    data-confirm-button-class="btn-success">
                                <i class="fa fa"></i>{{item.checkedBranchCount}}
                            </button>
                        </a>
                    </td>
                    <td>
                        <a href="#popupDepartments" data-toggle="modal">
                            <button class="btn mt-sweetalert btn green-meadow"
                                    title="Click to view details"
                                    (click)="getCheckedDepartmentsByMedicalServiceId(item)"
                                    data-confirm-button-class="btn-success">
                                <i class="fa fa"></i> {{item.checkedDepartmentCount}}
                            </button>
                        </a>
                    </td>
                    <td class="text-align-right">{{item.fee | number :'.2-2'}}</td>
                    <td class="text-align-right">{{item.tax.rate | number :'.2-2'}}</td>
                    <!--<td>{{item.calculateTax() | number :'.2-2'}}</td>-->
                    <td class="text-align-right">{{item.cost | number :'.2-2'}}</td>
                    <td>
                        <span [ngClass]="{'bg-green-meadow': item.status === true, 'bg-red-meadow': item.status === false}"
                                class="mt-action-dot">
                        </span>
                    </td>
                    <td>
                        <button class="font-blue"
                                routerLink="/dashboard/setting/medicalServices/edit/{{item.id}}">
                            <i class="fa fa-pencil"></i>
                        </button>
                        <span [hidden]="item.hasChild">
                             <button class="text-danger"
                                     (click)="deleteMedicalServices(item)">
                                <i class="fa fa-remove"></i>
                            </button>
                        </span>
                    </td>
                </tr>
            </ng-template>
        </p-table>
        <!--table-->

        <div class="clearfix"></div>
    </div>
</div>

<div id="popupBranches" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                <h4 class="modal-title">Branches</h4>
            </div>
            <div class="modal-body">
                <p class="font-red" *ngIf="checkedBranches.length <= 0">Service has no branches</p>
                <div class="scroller" style="height:150px" data-always-visible="1" data-rail-visible1="1">
                    <div class="row">
                        <address>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class="select2-bootstrap-prepend">
                                        <div class="checkbox-box cod-higt" id="branchNameDiv">
                                            <div class="col-md-6 branches-list">
                                                <ul>
                                                    <li *ngFor="let branch of checkedBranches">
                                                        <i class=" icon-home"></i>
                                                        <label class="">
                                                            {{branch.name}}
                                                            <span></span>
                                                        </label>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </address>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal"
                        id="close-btn-branch"
                        name="close-btn-branch"
                        class="btn btn-default btn-outline"
                        (click)="clearList($event)">Close
                </button>
            </div>
        </div>
    </div>
</div>

<div id="popupDepartments" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Departments</h4>
            </div>
            <div class="modal-body">
                <p class="font-red" *ngIf="checkedDepartments.length <= 0">Service has no departments</p>
                <div class="scroller" style="height:150px" data-always-visible="1" data-rail-visible1="1">
                    <div class="row">
                        <address>
                            <div class="form-group">
                                <div class="col-md-12">
                                    <div class="select2-bootstrap-prepend">
                                        <div class="checkbox-box hr cod-higt" id="branchDiv">
                                            <div class="col-md-12 branches-list">
                                                <ul>
                                                    <li *ngFor="let department of checkedDepartments">
                                                        <i class=" icon-home"></i>
                                                        <label>
                                                            {{department.name}}
                                                            <span></span>
                                                        </label>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </address>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" data-dismiss="modal"
                        id="close-btn-depart"
                        name="close-btn-depart"
                        class="btn btn-default btn-outline"
                        (click)="clearList($event)">Close
                </button>
            </div>
        </div>
    </div>
</div>